# Don't change the line below!
#! oxygen_storefront_id: 1000016926

name: Storefront 1000016926
on:
  pull_request:
    branches:
      - uk-main

jobs:
  deploy-preview:
    name: Merge into UK preview
    timeout-minutes: 30
    runs-on: ubuntu-latest
    env:
      TARGET: uk-preview
      BRANCH_NAME: ${{ github.head_ref }} 

    steps:
    - uses: actions/checkout@v3

    - name: Set Git config
      run: |
          git config --local user.email "actions@github.com"
          git config --local user.name "Github Actions"

    - name: create pull request
      id: open-pr
      uses: repo-sync/pull-request@v2
      with:
        github_token: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
        destination_branch: $TARGET
        pr_title: "[Automated] Merge $BRANCH_NAME into $TARGET"
          
    # - name: Merge master back to dev
    #   run: |
    #       git fetch --unshallow
    #       git checkout $TARGET
    #       git pull
    #       git merge --no-ff origin/$BRANCH_NAME -m "Auto-merge $BRANCH_NAME to uk-preview"
    #       git push

    



  # main:
  #   name: Create PR Release to Main
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: git checkout
  #       uses: actions/checkout@v3
  #       with:
  #         token: ${{ secrets.PERSONAL_ACCESS_TOKEN }}

  #     # https://github.com/marketplace/actions/github-pull-request-action
  #     - name: create pull request
  #       id: open-pr
  #       uses: repo-sync/pull-request@v2
  #       with:
  #         github_token: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
  #         destination_branch: ${{ github.event.repository.default_branch }}
  #         pr_title: "[Automated] Merge ${{ github.ref_name }} into ${{ github.event.repository.default_branch }}"

  #     # https://github.com/marketplace/actions/enable-pull-request-automerge
  #     - name: enable automerge
  #       if: steps.open-pr.outputs.pr_number != ''
  #       uses: peter-evans/enable-pull-request-automerge@v2
  #       with:
  #         token: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
  #         pull-request-number: ${{ steps.open-pr.outputs.pr_number }}
  #         merge-method: merge